{% extends 'chat/base.html' %}



{% block content %}
<style>
    .main-message {
    padding: 10px;
    border-radius: 20px;
    max-width: 60%;
    word-wrap: break-word;
    font-size: 16px;
    font-weight: bolder;
}

.main-message.user {
    background-color: #6637f3;
    color: white;
    align-self: flex-end;
}

/* Message from the bot */
.main-message.bot {
    background-color: #ffffff;
    color: #1a1a1a;
    align-self: flex-start;
}
</style>
{% if request.user.is_authenticated %}
<div class="main-chat">
    <div class="main-chat-header">
        <div class="chat-profile d-flex flex-row">
            <div class="chat-profile-img"></div>
            <div class="main-chat-profile-user mx-2  d-flex flex-column">
                <b> {{bot.name}}</b>
                <small class="font-small" style="font-size: 8px;">@{{bot.uuid}}</small>
            </div>
        </div>
    </div>
    <div class="chat-messages">
        <div class="message bot">need your <br>
            favourite person?</div>
        <div class="message user">ofc..but how?</div>
    </div>
    <div class="chat-input-container">
        <input type="text" class="cs-form-control chat-input" placeholder="type message..">
        <button class="send-btn"><i class="fa-solid fa-circle-arrow-right"></i></button>
    </div>

</div>
{% else %}
<div class="main-chat d-flex justify-content-center align-items-center">

    <div class="page-message text-white text-center ">
        <b><h2>to access your person please</h2></b>
        <a href="{% url 'login-user' %}"><button class="cs-button">login</button></a>
    </div>
    </div>
{% endif %}

<script>

    function renderChatsToHtml(chats){
        let chatMessages = $(".chat-messages");
        chats.forEach(chat => {
            let message = `<div class="main-message ${chat.sender}">${chat.message}</div>`;
            chatMessages.append(message);
        });
    }

    function buildchat(){
        $.ajax({
            url: "",
            type: "GET",
            success: function (response) {
                console.log(response);
                renderChatsToHtml(response["chat_messages"]);
            },
            error: function (error) {
                console.log(error);
            }
        });
    };
    $(document).ready(function () {
        buildchat();
    });

    $(".send-btn").on("click",(e)=>{
        e.preventDefault();
        let message = $(".chat-input").val();
        $.ajax({
            url: "",
            type: "POST",
            data: {
                message: message,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                buildchat();
            },
            error: function (error) {
                console.log(error);
            }
        });
    })
</script>


{% endblock content %}